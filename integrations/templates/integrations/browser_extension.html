{% extends 'base.html' %}
{% load static %}

{% block title %}Browser Extension - Kitchentory{% endblock %}

{% block extra_css %}
<style>
.browser-extension-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.extension-section {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    margin-bottom: 24px;
    overflow: hidden;
}

.section-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e5e7eb;
    background: #f9fafb;
}

.section-title {
    font-size: 18px;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 4px 0;
}

.section-description {
    color: #6b7280;
    font-size: 14px;
    margin: 0;
}

.section-content {
    padding: 24px;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.feature-card {
    padding: 20px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    text-align: center;
}

.feature-icon {
    width: 48px;
    height: 48px;
    margin: 0 auto 12px;
    color: #10b981;
}

.feature-title {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 8px;
}

.feature-description {
    color: #6b7280;
    font-size: 14px;
    line-height: 1.5;
}

.step-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.step-item {
    display: flex;
    margin-bottom: 20px;
    align-items: flex-start;
}

.step-number {
    width: 32px;
    height: 32px;
    background: #10b981;
    color: white;
    border-radius: 50%;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 16px;
    flex-shrink: 0;
}

.step-content {
    flex: 1;
}

.step-title {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 8px;
}

.step-description {
    color: #6b7280;
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 12px;
}

.step-code {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 12px;
    font-family: monospace;
    font-size: 13px;
    color: #374151;
    margin-top: 8px;
}

.download-card {
    background: #f0fdf4;
    border: 2px solid #bbf7d0;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    margin-bottom: 20px;
}

.download-title {
    font-size: 20px;
    font-weight: 600;
    color: #065f46;
    margin-bottom: 8px;
}

.download-description {
    color: #047857;
    margin-bottom: 16px;
}

.btn {
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: #10b981;
    color: white;
}

.btn-primary:hover {
    background: #059669;
    color: white;
    text-decoration: none;
}

.btn-secondary {
    background: #f3f4f6;
    color: #374151;
    border: 1px solid #d1d5db;
}

.btn-secondary:hover {
    background: #e5e7eb;
    color: #374151;
    text-decoration: none;
}

.supported-sites {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.site-card {
    display: flex;
    align-items: center;
    padding: 16px;
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
}

.site-logo {
    width: 40px;
    height: 40px;
    background: #10b981;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 12px;
    color: white;
    font-weight: 600;
    font-size: 14px;
}

.site-info {
    flex: 1;
}

.site-name {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 2px;
}

.site-status {
    font-size: 12px;
    color: #059669;
    font-weight: 500;
}

.alert {
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.alert-info {
    background: #dbeafe;
    border: 1px solid #bfdbfe;
    color: #1e40af;
}

.alert-warning {
    background: #fef3c7;
    border: 1px solid #fde68a;
    color: #92400e;
}

.code-block {
    background: #1f2937;
    color: #f9fafb;
    padding: 16px;
    border-radius: 8px;
    font-family: monospace;
    font-size: 13px;
    line-height: 1.5;
    overflow-x: auto;
    margin: 12px 0;
}

@media (max-width: 768px) {
    .feature-grid {
        grid-template-columns: 1fr;
    }
    
    .supported-sites {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="browser-extension-container">
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Kitchentory Browser Extension</h1>
        <p class="text-gray-600">Automatically capture grocery items while shopping online</p>
    </div>

    <!-- Download Section -->
    <div class="download-card">
        <div class="download-title">üì¶ Ready to Install</div>
        <p class="download-description">
            The browser extension is already included in your Kitchentory installation. Follow the guide below to load it in Chrome.
        </p>
        <div class="flex justify-center gap-4">
            <a href="#installation" class="btn btn-primary">
                üì• Installation Guide
            </a>
            <a href="#extension-location" onclick="showExtensionPath()" class="btn btn-secondary">
                üìÇ Show Extension Path
            </a>
        </div>
    </div>
    
    <!-- Extension Path Alert -->
    <div id="extension-location" class="alert alert-info" style="display: none;">
        <strong>Extension Location:</strong> The browser extension files are located at:<br>
        <code style="font-family: monospace; background: #f3f4f6; padding: 4px 8px; border-radius: 4px; display: inline-block; margin-top: 8px;">
            /Users/macbookair/dev/kitchentory/browser-extension
        </code>
    </div>

    <!-- Features -->
    <div class="extension-section">
        <div class="section-header">
            <h2 class="section-title">‚ú® Key Features</h2>
            <p class="section-description">What the browser extension can do for you</p>
        </div>
        <div class="section-content">
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div class="feature-title">Auto-Capture</div>
                    <div class="feature-description">
                        Automatically detects when you add items to your cart and captures product details
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </div>
                    <div class="feature-title">Real-time Sync</div>
                    <div class="feature-description">
                        Items sync immediately to your Kitchentory inventory as you shop
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                    <div class="feature-title">Secure</div>
                    <div class="feature-description">
                        Uses secure token authentication and only captures grocery data
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div class="feature-title">Smart Detection</div>
                    <div class="feature-description">
                        Extracts product names, quantities, prices, and categories automatically
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Supported Sites -->
    <div class="extension-section">
        <div class="section-header">
            <h2 class="section-title">üè™ Supported Shopping Sites</h2>
            <p class="section-description">Works with major grocery and shopping websites</p>
        </div>
        <div class="section-content">
            <div class="supported-sites">
                <div class="site-card">
                    <div class="site-logo">IC</div>
                    <div class="site-info">
                        <div class="site-name">Instacart</div>
                        <div class="site-status">‚úÖ Fully Supported</div>
                    </div>
                </div>
                <div class="site-card">
                    <div class="site-logo">AF</div>
                    <div class="site-info">
                        <div class="site-name">Amazon Fresh</div>
                        <div class="site-status">‚úÖ Fully Supported</div>
                    </div>
                </div>
                <div class="site-card">
                    <div class="site-logo">WG</div>
                    <div class="site-info">
                        <div class="site-name">Walmart Grocery</div>
                        <div class="site-status">‚úÖ Fully Supported</div>
                    </div>
                </div>
                <div class="site-card">
                    <div class="site-logo">WF</div>
                    <div class="site-info">
                        <div class="site-name">Whole Foods</div>
                        <div class="site-status">üîÑ Coming Soon</div>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-info mt-6">
                <strong>More stores coming!</strong> We're continuously adding support for more grocery websites. 
                Request support for your favorite store by contacting us.
            </div>
        </div>
    </div>

    <!-- Installation Guide -->
    <div class="extension-section" id="installation">
        <div class="section-header">
            <h2 class="section-title">üì• Installation Guide</h2>
            <p class="section-description">Step-by-step instructions to install and set up the extension</p>
        </div>
        <div class="section-content">
            <ol class="step-list">
                <li class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Locate Extension Files</div>
                        <div class="step-description">
                            The browser extension is already included in your Kitchentory installation. Navigate to the extension folder:
                        </div>
                        <div class="step-code">
                            cd {{ request.META.PWD|default:"/path/to" }}/kitchentory/browser-extension
                        </div>
                        <div class="alert alert-info mt-3">
                            <strong>Your extension is located at:</strong><br>
                            <code>/Users/macbookair/dev/kitchentory/browser-extension</code>
                        </div>
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Open Chrome Extensions</div>
                        <div class="step-description">
                            Open Google Chrome and navigate to the extensions management page.
                        </div>
                        <div class="step-code">
                            chrome://extensions/
                        </div>
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Enable Developer Mode</div>
                        <div class="step-description">
                            Toggle "Developer mode" in the top right corner of the extensions page.
                        </div>
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Load Unpacked Extension</div>
                        <div class="step-description">
                            Click "Load unpacked" and select the browser-extension folder you downloaded.
                        </div>
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <div class="step-title">Configure Server URL</div>
                        <div class="step-description">
                            Click the Kitchentory extension icon and enter your server URL:
                        </div>
                        <div class="step-code">
                            {{ request.scheme }}://{{ request.get_host }}
                        </div>
                    </div>
                </li>
                <li class="step-item">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <div class="step-title">Login and Start Shopping</div>
                        <div class="step-description">
                            Login with your Kitchentory credentials and visit a supported shopping site to start capturing items automatically.
                        </div>
                    </div>
                </li>
            </ol>
        </div>
    </div>

    <!-- Technical Details -->
    <div class="extension-section">
        <div class="section-header">
            <h2 class="section-title">üîß Technical Details</h2>
            <p class="section-description">For developers and advanced users</p>
        </div>
        <div class="section-content">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3">API Endpoints Used</h4>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div>‚Ä¢ <code>POST /api/auth/login/</code> - Authentication</div>
                        <div>‚Ä¢ <code>POST /api/inventory/items/bulk_add/</code> - Add items</div>
                        <div>‚Ä¢ <code>GET /api/inventory/categories/</code> - Categories</div>
                        <div>‚Ä¢ <code>GET /api/inventory/locations/</code> - Locations</div>
                    </div>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900 mb-3">Extension Architecture</h4>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div>‚Ä¢ <strong>Background Script:</strong> Token management</div>
                        <div>‚Ä¢ <strong>Content Scripts:</strong> Site-specific capture</div>
                        <div>‚Ä¢ <strong>Popup:</strong> User controls and status</div>
                        <div>‚Ä¢ <strong>API Service:</strong> Backend communication</div>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-warning mt-6">
                <strong>Development Status:</strong> This extension is currently in development. 
                Features and supported sites may change. Report issues on GitHub.
            </div>
        </div>
    </div>

    <!-- Back to Dashboard -->
    <div class="text-center mt-8">
        <a href="{% url 'integrations:dashboard' %}" class="btn btn-secondary">
            ‚Üê Back to Integration Dashboard
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Show extension path
function showExtensionPath() {
    const pathDiv = document.getElementById('extension-location');
    if (pathDiv.style.display === 'none') {
        pathDiv.style.display = 'block';
        pathDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    } else {
        pathDiv.style.display = 'none';
    }
    return false;
}

// Copy server URL to clipboard
function copyServerUrl() {
    const serverUrl = "{{ request.scheme }}://{{ request.get_host }}";
    navigator.clipboard.writeText(serverUrl).then(() => {
        alert('Server URL copied to clipboard!');
    }).catch(err => {
        console.error('Failed to copy server URL:', err);
    });
}

// Smooth scroll to installation section
document.addEventListener('DOMContentLoaded', function() {
    const installLink = document.querySelector('a[href="#installation"]');
    if (installLink) {
        installLink.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('installation').scrollIntoView({
                behavior: 'smooth'
            });
        });
    }
});
</script>
{% endblock %}